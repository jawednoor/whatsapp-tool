
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙˆÙ„Ø¯ Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
    }
    textarea, input[type="file"], button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .number-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #ffffff;
      padding: 10px;
      margin-bottom: 5px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .number-link {
      flex-grow: 1;
      color: #007bff;
      text-decoration: none;
      margin-left: 10px;
      direction: ltr;
    }
    .number-link.sent {
      color: #155724;
    }
    .delete-btn {
      background-color: #ff4d4d;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .delete-btn:hover {
      background-color: #cc0000;
    }
    .upload-btn {
      background-color: #6c63ff;
      color: white;
      padding: 10px;
      margin-bottom: 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Ù…ÙˆÙ„Ø¯ Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</h2>

  <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 15px;">
    <div style="flex:1;">
      <label>ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ù…Ù„Ù TXT (ÙƒÙ„ Ø±Ù‚Ù… ÙÙŠ Ø³Ø·Ø±)</label>
      <input type="file" id="fileInput" accept=".txt">
    </div>
    <div style="flex:1;">
      <label>ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø³ØªÙ„Ù…ÙŠÙ† Ù…Ù† Ù…Ù„Ù CSV (Ø§Ø³Ù…,Ø±Ù‚Ù…)</label>
      <input type="file" id="csvInput" accept=".csv">
    </div>
  </div>

  <label>âœï¸ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§ (ÙƒÙ„ Ø±Ù‚Ù… ÙÙŠ Ø³Ø·Ø±)</label>
  <textarea id="numbers" rows="6" placeholder="Ù…Ø«Ø§Ù„:
+966500000000
+201000000000"></textarea>

  <label>ğŸ’¬ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
  <textarea id="message" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>

  <button class="upload-btn" onclick="window.open('https://postimages.org/', '_blank')">ğŸ“ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø£Ùˆ Ù…Ø³ØªÙ†Ø¯ Ø¹Ø¨Ø± postimages</button>

  <button onclick="generateLinks()">ğŸš€ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
  <button onclick="exportRemaining()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</button>

    <button onclick="autoSendLinks()" style="background-color:#28a745;color:white;">ğŸ¤– Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</button>

    <div id="stats" style="margin-bottom:15px; font-weight:bold;"></div>

  <div id="numbersContainer"></div>

    <style>
        .numbers-table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
          table-layout: fixed;
        }
        .numbers-table th, .numbers-table td {
          border: 1px solid #ddd;
          padding: 10px 0;
          text-align: center;
          vertical-align: middle;
          font-size: 16px;
        }
        .numbers-table th {
          background-color: #f7f7f7;
          font-weight: bold;
        }
        .numbers-table th:nth-child(1),
        .numbers-table td:nth-child(1) {
          width: 35%;
        }
        .numbers-table th:nth-child(2),
        .numbers-table td:nth-child(2) {
          width: 35%;
        }
        .numbers-table th:nth-child(3),
        .numbers-table td:nth-child(3) {
          width: 20%;
        }
        .numbers-table th:nth-child(4),
        .numbers-table td:nth-child(4) {
          width: 10%;
        }
    </style>

  <script>
    const fileInput = document.getElementById("fileInput");
    const numbersTextarea = document.getElementById("numbers");
    const messageInput = document.getElementById("message");
    const numbersContainer = document.getElementById("numbersContainer");

    const csvInput = document.getElementById("csvInput");
    let importedCSV = [];

    fileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const imported = e.target.result.trim();
        numbersTextarea.value = imported;
      };
      reader.readAsText(file);
    });

      // Ø§Ø³ØªÙŠØ±Ø§Ø¯ CSV
      csvInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          const lines = e.target.result.split(/\r?\n|\r/);
          importedCSV = [];
          lines.forEach(line => {
            // Ø¯Ø¹Ù… Ø§Ù„ÙØ§ØµÙ„Ø© Ø£Ùˆ Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆØ·Ø©
            let parts = line.split(/,|;/);
            if (parts.length >= 2) {
              let name = parts[0].trim();
              let number = parts[1].replace(/\s+/g, '').trim();
              if (/^\+?\d{8,15}$/.test(number)) {
                importedCSV.push({ name, number });
              }
            }
          });
          // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ textarea (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          numbersTextarea.value = importedCSV.map(x => x.number).join("\n");
        };
        reader.readAsText(file);
      });

    function generateLinks() {
      const rawNumbers = numbersTextarea.value.trim();
      const message = messageInput.value.trim();
      numbersContainer.innerHTML = "";

        // Ø¥Ø´Ø¹Ø§Ø± Ø°ÙƒÙŠ
        const stats = document.getElementById("stats");
        stats.textContent = "";

      if (!rawNumbers || !message) {
        numbersContainer.innerHTML = "<strong>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø©.</strong>";
          stats.textContent = "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø§Ù„Ø±Ø³Ø§Ù„Ø©";
        return;
      }

      const encodedMessage = encodeURIComponent(message);


        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§ØªØŒ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
        let numbers = rawNumbers.split(/\r?\n|\r/)
          .map(n => n.replace(/\s+/g, '').trim())
          .filter(n => n.length > 5 && /^\+?\d{8,15}$/.test(n));
        // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        numbers = Array.from(new Set(numbers));

        if (numbers.length === 0) {
          numbersContainer.innerHTML = "<strong>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… ØµØ§Ù„Ø­Ø©.</strong>";
          stats.textContent = "âš ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ø£Ùˆ Ù…ÙƒØ±Ø±Ø©";
          return;
        }

        let sentCount = 0;

      numbers.forEach(number => {
        const container = document.createElement("div");
        container.className = "number-entry";

        const link = document.createElement("a");
        link.href = `https://wa.me/${number.replace('+', '')}?text=${encodedMessage}`;
        link.target = "_blank";
        link.className = "number-link";
        link.textContent = "+" + number.replace('+', '');

          link.addEventListener("click", () => {
            link.classList.add("sent");
            link.textContent = "+" + number.replace('+', '') + " âœ… ØªÙ… Ø§Ù„ÙØªØ­";
            sentCount++;
            updateStats(numbers.length, sentCount);
          });

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "âŒ";
          deleteBtn.onclick = () => {
            container.remove();
            updateStats(numbers.length, document.querySelectorAll('.number-link.sent').length);

            // Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ CSVØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù…
            if (importedCSV.length > 0) {
              importedCSV.forEach(({ name, number }) => {
                if (!numbers.includes(number)) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                const container = document.createElement("div");
                container.className = "number-entry";

                const infoSpan = document.createElement("span");
                infoSpan.style = "margin-left:10px; font-weight:500; color:#333;";
                infoSpan.textContent = name ? `ğŸ‘¤ ${name}` : "";

                const link = document.createElement("a");
                link.href = `https://wa.me/${number.replace('+', '')}?text=${encodedMessage}`;
                link.target = "_blank";
                link.className = "number-link";
                link.textContent = "+" + number.replace('+', '');

                link.addEventListener("click", () => {
                  link.classList.add("sent");
                  link.textContent = "+" + number.replace('+', '') + " âœ… ØªÙ… Ø§Ù„ÙØªØ­";
                  sentCount++;
                  updateStats(numbers.length, sentCount);
                });

                const deleteBtn = document.createElement("button");
                deleteBtn.className = "delete-btn";
                deleteBtn.textContent = "âŒ";
                deleteBtn.onclick = () => {
                  container.remove();
                  updateStats(numbers.length, document.querySelectorAll('.number-link.sent').length);
                };

                container.appendChild(infoSpan);
                container.appendChild(link);
                container.appendChild(deleteBtn);
                numbersContainer.appendChild(container);
              });
            } else {
              numbers.forEach(number => {
                const container = document.createElement("div");
                container.className = "number-entry";

                const link = document.createElement("a");
                link.href = `https://wa.me/${number.replace('+', '')}?text=${encodedMessage}`;
                link.target = "_blank";
                link.className = "number-link";
                link.textContent = "+" + number.replace('+', '');

                link.addEventListener("click", () => {
                  link.classList.add("sent");
                  link.textContent = "+" + number.replace('+', '') + " âœ… ØªÙ… Ø§Ù„ÙØªØ­";
                  sentCount++;
                  updateStats(numbers.length, sentCount);
                });

                const deleteBtn = document.createElement("button");
                deleteBtn.className = "delete-btn";
                deleteBtn.textContent = "âŒ";
                deleteBtn.onclick = () => {
                  container.remove();
                  updateStats(numbers.length, document.querySelectorAll('.number-link.sent').length);
                };

                container.appendChild(link);
                container.appendChild(deleteBtn);
                numbersContainer.appendChild(container);
              });
            }
          }; // <-- Close deleteBtn.onclick
        });

        // Update stats after generating all links
        updateStats(numbers.length, sentCount);
      } // <-- Close generateLinks function

    function updateStats(total, sent) {
      const stats = document.getElementById("stats");
      stats.textContent = `ØªÙ… ØªØ¬Ù‡ÙŠØ² ${total} Ø±Ù‚Ù…. ØªÙ… ÙØªØ­ ${sent} Ø±Ø§Ø¨Ø·. Ù…ØªØ¨Ù‚ÙŠ ${total - sent}`;
    }

    function exportRemaining() {
      const links = document.querySelectorAll('.number-link:not(.sent)');
      const numbers = Array.from(links).map(link => link.textContent.split(' ')[0]);
      if (numbers.length === 0) {
        alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù…ØªØ¨Ù‚ÙŠØ©!");
        return;
      }
      const blob = new Blob([numbers.join('\n')], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "filtered_numbers.txt";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

      // Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
      function autoSendLinks() {
        const rawNumbers = numbersTextarea.value.trim();
        const message = messageInput.value.trim();
        let numbers = rawNumbers.split(/\r?\n|\r/)
          .map(n => n.replace(/\s+/g, '').trim())
          .filter(n => n.length > 5 && /^\+?\d{8,15}$/.test(n));
        numbers = Array.from(new Set(numbers));
        if (numbers.length === 0 || !message) {
          alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© ÙˆÙ†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©");
          return;
        }
        const encodedMessage = encodeURIComponent(message);
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…
        let tableHTML = '<table class="numbers-table"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th><th>Ø­Ø°Ù</th></tr></thead><tbody>';

        // Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ CSVØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù…
        if (importedCSV.length > 0) {
          importedCSV.forEach(({ name, number }) => {
            if (!numbers.includes(number)) return;
            const linkUrl = `https://wa.me/${number.replace('+', '')}?text=${encodedMessage}`;
            tableHTML += `<tr><td>${name || ''}</td><td>+${number.replace('+', '')}</td><td><a href="${linkUrl}" target="_blank" class="number-link">Ø¥Ø±Ø³Ø§Ù„</a></td><td><button class="delete-btn" onclick="this.closest('tr').remove()">âŒ</button></td></tr>`;
          });
        } else {
          numbers.forEach(number => {
            const linkUrl = `https://wa.me/${number.replace('+', '')}?text=${encodedMessage}`;
            tableHTML += `<tr><td></td><td>+${number.replace('+', '')}</td><td><a href="${linkUrl}" target="_blank" class="number-link">Ø¥Ø±Ø³Ø§Ù„</a></td><td><button class="delete-btn" onclick="this.closest('tr').remove()">âŒ</button></td></tr>`;
          });
        }
        tableHTML += '</tbody></table>';
        numbersContainer.innerHTML = tableHTML;
        let i = 0;
        function openNext() {
          if (i >= numbers.length) {
            alert("ØªÙ… ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·!");
            return;
          }
          const url = `https://wa.me/${numbers[i].replace('+', '')}?text=${encodedMessage}`;
          window.open(url, '_blank');
          i++;
          setTimeout(openNext, 5000); // 5 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† ÙƒÙ„ Ø¥Ø±Ø³Ø§Ù„
        }
        openNext();
      }
  </script>

</body>
</html>
